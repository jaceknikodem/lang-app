#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🚀 Running pre-push checks..."

# Type checking
echo "📝 Type checking..."
npm run lint || {
  echo "❌ Type checking failed. Please fix TypeScript errors before pushing."
  exit 1
}

# Full build
echo "🔨 Full build..."
npm run build || {
  echo "❌ Build failed. Please fix build errors before pushing."
  exit 1
}

# E2E tests (the most important for functionality)
echo "🎭 Running E2E tests..."
npm run test:e2e || {
  echo "⚠️  E2E tests failed. You can still push, but please investigate."
  echo "💡 Run 'npm run test:e2e' to debug the issues."
  echo "💡 To skip this check: git push --no-verify"
  
  # Ask user if they want to continue
  read -p "Continue with push anyway? (y/N): " -n 1 -r
  echo
  if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    exit 1
  fi
}

echo "✅ Pre-push checks completed!"